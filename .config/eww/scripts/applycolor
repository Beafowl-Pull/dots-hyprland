#!/usr/bin/env bash

cd "$HOME/.config/eww" || exit
filelist=$(ls 'images/svg/template/' | grep -v /)
colorscss=$(cat css/_material.scss)
colornames=$(cat css/_material.scss | cut -d: -f1)
colorstrings=$(cat css/_material.scss | cut -d: -f2 | cut -d ' ' -f2 | cut -d ";" -f1)
IFS=$'\n'
filearr=($(echo "$filelist")) # Get colors
colorlist=($(echo "$colornames")) # Array of color names
colorvalues=($(echo "$colorstrings")) # Array of color values

apply_svgs() {
    for i in "${!filearr[@]}"; do
        # echo "images/svg/${filearr[$i]}"
        colorvalue=$(echo "$colorscss" | grep "${filearr[$i]}" | awk '{print $2}' | cut -d ";" -f1)
        
        for file in images/svg/template/"${filearr[$i]}"/*; do
            cp "$file" images/svg/
            sed -i "s/black/$colorvalue/g" images/svg/"${file##*/}"
        done
        # sed -i "s/white/$1/gi" "images/svg/${filearr[$i]}"
    done
}

apply_gtklock() {
    # Check if $HOME/.config/gtklock/template/style.css exists
    if [ ! -f "$HOME/.config/gtklock/template/style.css" ]; then
        echo "Template file not found for Gtklock. Skipping that."
        return
    fi
    
    # Copy template to style.css
    cp "$HOME/.config/gtklock/template/style.css" "$HOME/.config/gtklock/style.css"
    
    # Apply colors
    for i in "${!colorlist[@]}"; do
        sed -i "s/${colorlist[$i]};/${colorvalues[$i]};/g" "$HOME/.config/gtklock/style.css"
    done
}

apply_svgs
apply_gtklock